<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>İki Kişilik Sohbet</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; background-color: #128C7E; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #container { width: 100%; max-width: 500px; height: 100vh; background-color: #ece5dd; border-radius: 10px; display: flex; flex-direction: column; box-shadow: 0 4px 10px rgba(0,0,0,0.3); overflow: hidden; }
        h2 { background-color: #075E54; color: white; margin: 0; padding: 20px; text-align: center; font-size: 26px; }
        #login, #chat { flex: 1; display: none; flex-direction: column; padding: 20px; justify-content: center; align-items: center; }
        #login input { width: 80%; padding: 15px; margin: 10px 0; font-size: 18px; border-radius: 10px; border: 1px solid #ccc; }
        #login button { padding: 10px 20px; font-size: 18px; border-radius: 10px; background-color: #25D366; color: white; border: none; }
        #status { font-size: 12px; color: gray; margin-bottom: 5px; text-align: center; }
        #messages { background: #fff; flex: 1; overflow-y: scroll; padding: 10px; }
        .message { display: flex; align-items: center; margin: 10px 0; padding: 8px 12px; border-radius: 20px; max-width: 75%; animation: fadeIn 0.3s ease; }
        .me { background-color: #dcf8c6; margin-left: auto; }
        .other { background-color: #fff; border: 1px solid #ccc; margin-right: auto; }
        .avatar { width: 30px; height: 30px; border-radius: 50%; margin-right: 8px; }
        .text-block { display: flex; flex-direction: column; }
        .time { font-size: 10px; color: gray; margin-top: 3px; }
        #inputArea { display: flex; padding: 10px; background-color: #f0f0f0; position: sticky; bottom: 0; }
        #messageInput { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; margin-right: 10px; resize: none; height: 40px; }
        #inputArea button { padding: 10px 15px; background-color: #25D366; color: white; border: none; border-radius: 50%; font-size: 18px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 600px) { #container { border-radius: 0; } }
    </style>
</head>
<body>

<div id="container">
    <h2>İki Kişilik Sohbet</h2>

    <div id="login">
        <input type="text" id="username" placeholder="Kullanıcı Adı">
        <input type="password" id="password" placeholder="Şifre">
        <button onclick="login()">Giriş Yap</button>
        <p id="loginError" style="color: red; text-align:center;"></p>
    </div>

    <div id="chat">
        <div id="status"></div>
        <div id="messages"></div>
        <div id="inputArea">
            <textarea id="messageInput" placeholder="Mesaj yaz..."></textarea>
            <button onclick="sendMessage()"><i class="fa fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCPejajCJIhR_STwr6Czm_hGsOLEPng3Bw",
        authDomain: "sohbet-sitesi-2d0d8.firebaseapp.com",
        databaseURL: "https://sohbet-sitesi-2d0d8-default-rtdb.firebaseio.com",
        projectId: "sohbet-sitesi-2d0d8",
        storageBucket: "sohbet-sitesi-2d0d8.appspot.com",
        messagingSenderId: "554862357464",
        appId: "1:554862357464:web:ea1f72b4627147b47460ad"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const validUsers = {
        erenyel: '0507eren2003',
        edayontem: 'eday2003'
    };

    const userAvatars = {
        erenyel: 'eren.png',
        edayontem: 'eda.png'
    };

    let currentUser = '';
    let otherUser = '';

    document.getElementById('login').style.display = 'flex';

    function login() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();

        if (validUsers[username] && validUsers[username] === password) {
            currentUser = username;
            otherUser = Object.keys(validUsers).find(u => u !== username);

            document.getElementById('login').style.display = 'none';
            document.getElementById('chat').style.display = 'flex';

            db.ref('status/' + currentUser).set({ online: true });
            db.ref('status/' + currentUser).onDisconnect().set({ online: false, lastSeen: new Date().toLocaleString() });

            listenForMessages();
            listenForStatus();

            document.getElementById('messageInput').addEventListener('keydown', function(e) {
                if (window.innerWidth > 600 && e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        } else {
            document.getElementById('loginError').innerText = 'Hatalı kullanıcı adı veya şifre!';
        }
    }

    function sendMessage() {
        const input = document.getElementById('messageInput');
        const message = input.value.trim();
        if (message === '') return;

        db.ref('messages').push({
            user: currentUser,
            text: message,
            timestamp: Date.now()
        });

        input.value = '';
    }

    function listenForMessages() {
        const messagesDiv = document.getElementById('messages');
        messagesDiv.innerHTML = '';

        db.ref('messages').on('child_added', function(snapshot) {
            const msg = snapshot.val();
            const msgElement = document.createElement('div');
            msgElement.classList.add('message');
            msgElement.classList.add(msg.user === currentUser ? 'me' : 'other');

            const avatar = document.createElement('img');
            avatar.src = userAvatars[msg.user];
            avatar.className = 'avatar';

            const textBlock = document.createElement('div');
            textBlock.className = 'text-block';

            const textSpan = document.createElement('span');
            textSpan.innerText = msg.text;

            const timeSpan = document.createElement('span');
            const time = new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            timeSpan.className = 'time';
            timeSpan.innerText = time;

            textBlock.appendChild(textSpan);
            textBlock.appendChild(timeSpan);

            msgElement.appendChild(avatar);
            msgElement.appendChild(textBlock);
            messagesDiv.appendChild(msgElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }

    function listenForStatus() {
        const statusDiv = document.getElementById('status');
        db.ref('status/' + otherUser).on('value', function(snapshot) {
            const status = snapshot.val();
            if (status && status.online) {
                statusDiv.innerText = `${otherUser} çevrimiçi`;
            } else if (status && status.lastSeen) {
                statusDiv.innerText = `${otherUser} son görülme: ${status.lastSeen}`;
            } else {
                statusDiv.innerText = `${otherUser} çevrimdışı`;
            }
        });
    }
</script>

</body>
</html>
